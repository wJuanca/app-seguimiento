<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Mis Equipos - Sistema de Gestión</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css" rel="stylesheet">
  <link rel="stylesheet" href="/css/main.css">
  <style>
    .equipo-card {
      transition: transform 0.2s, box-shadow 0.2s;
      height: 100%;
    }
    
    .equipo-card:hover {
      transform: translateY(-5px);
      box-shadow: 0 10px 15px rgba(0, 0, 0, 0.1);
    }
    
    .estado-badge {
      position: absolute;
      top: 10px;
      right: 10px;
      padding: 0.35rem 0.65rem;
      border-radius: 50rem;
      font-size: 0.75rem;
      font-weight: 600;
      text-transform: capitalize;
    }
    
    .estado-disponible {
      background-color: #d1fae5;
      color: #065f46;
    }
    
    .estado-asignado {
      background-color: #dbeafe;
      color: #1e40af;
    }
    
    .estado-en_proceso {
      background-color: #cce5ff;
      color: #004085;
    }
    
    .estado-pendiente {
      background-color: #fff3cd;
      color: #856404;
    }
    
    .estado-reparado {
      background-color: #d4edda;
      color: #155724;
    }
    
    .estado-descartado {
      background-color: #f8d7da;
      color: #721c24;
    }
    
    .equipo-icon {
      font-size: 2.5rem;
      margin-bottom: 1rem;
      color: #2563eb;
    }
    
    .equipo-info {
      margin-bottom: 0.5rem;
    }
    
    .equipo-info strong {
      color: #4b5563;
    }
    
    .equipo-footer {
      margin-top: auto;
      padding-top: 1rem;
      border-top: 1px solid #e5e7eb;
    }
    
    .no-equipos {
      text-align: center;
      padding: 3rem;
      background-color: white;
      border-radius: 0.5rem;
      box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05);
    }
    
    .no-equipos-icon {
      font-size: 4rem;
      color: #94a3b8;
      margin-bottom: 1rem;
    }
  </style>
</head>
<body>
  <%- include('../partials/header.ejs') %>
  
  <div class="container mt-5">
    <h1 class="mb-4">Mis Equipos</h1>
    
    <% if (mensajes && mensajes.error) { %>
      <div class="alert alert-danger alert-dismissible fade show" role="alert">
        <%= mensajes.error %>
        <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Cerrar"></button>
      </div>
    <% } %>
    
    <% if (mensajes && mensajes.success) { %>
      <div class="alert alert-success alert-dismissible fade show" role="alert">
        <%= mensajes.success %>
        <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Cerrar"></button>
      </div>
    <% } %>
    
    <% if (equipos && equipos.length > 0) { %>
      <div class="row row-cols-1 row-cols-md-2 row-cols-lg-3 g-4">
        <% equipos.forEach(equipo => { %>
          <div class="col">
            <div class="card h-100 equipo-card">
              <div class="card-body d-flex flex-column">
                <% if (equipo.estado === 'en_reparacion' && equipo.estado_reparacion) { %>
                  <span class="estado-badge estado-<%= equipo.estado_reparacion %>">
                    <%= equipo.estado_reparacion === 'pendiente' ? 'Pendiente de reparación' : 'En reparación' %>
                  </span>
                <% } else { %>
                  <span class="estado-badge <%= 
                    equipo.estado === 'disponible' ? 'estado-disponible' : 
                    equipo.estado === 'asignado' ? 'estado-asignado' : 
                    equipo.estado === 'en_reparacion' ? 'estado-en_proceso' : 
                    'estado-descartado' 
                  %>">
                    <%= equipo.estado.replace('_', ' ') %>
                  </span>
                <% } %>
                
                <div class="text-center mb-3">
                  <i class="bi <%= 
                    equipo.tipo === 'laptop' ? 'bi-laptop' : 
                    equipo.tipo === 'desktop' ? 'bi-pc-display' : 
                    equipo.tipo === 'impresora' ? 'bi-printer' : 
                    equipo.tipo === 'servidor' ? 'bi-server' : 
                    'bi-device-hdd' 
                  %> equipo-icon"></i>
                  <h5 class="card-title"><%= equipo.nombre %></h5>
                </div>
                
                <div class="equipo-info">
                  <strong>Tipo:</strong> <%= equipo.tipo %>
                </div>
                <div class="equipo-info">
                  <strong>Marca:</strong> <%= equipo.marca %>
                </div>
                <div class="equipo-info">
                  <strong>Modelo:</strong> <%= equipo.modelo %>
                </div>
                
                <% if (equipo.estado === 'en_reparacion' && equipo.id_reparacion) { %>
                  <div class="alert <%= equipo.estado_reparacion === 'pendiente' ? 'alert-warning' : 'alert-info' %> mt-3">
                    <strong><%= equipo.estado_reparacion === 'pendiente' ? 'Pendiente de asignación:' : 'En reparación:' %></strong>
                    <p class="mb-1"><%= equipo.descripcion_problema %></p>
                    <div>
                      <small>Desde: <%= new Date(equipo.fecha_inicio).toLocaleDateString() %></small>
                      <% if (equipo.nombre_tecnico) { %>
                        <br><small>Técnico: <%= equipo.nombre_tecnico %></small>
                      <% } %>
                    </div>
                  </div>
                <% } %>
                
                <div class="equipo-footer">
                  <a href="/mi-equipo/detalles/<%= equipo.id_equipo %>" class="btn btn-primary w-100">
                    Ver detalles
                  </a>
                </div>
              </div>
            </div>
          </div>
        <% }) %>
      </div>
    <% } else { %>
      <div class="no-equipos">
        <i class="bi bi-inbox no-equipos-icon"></i>
        <h3>No tienes equipos asignados</h3>
        <p class="text-muted">Actualmente no tienes ningún equipo asignado a tu cuenta.</p>
      </div>
    <% } %>
  </div>
  
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>

