<link rel="stylesheet" href="/css/main.css">

<style>
/* Estilos para el header */
.header {
  background-color: var(--primary, #2563eb);
  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  z-index: 1000;
  margin: 0;
}

.container-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 0.75rem 2rem;
  width: 100%;
  max-width: 1200px;
  margin: 0 auto;
  box-sizing: border-box;
}

/* Logo */
.logo {
  display: flex;
  align-items: center;
  transition: transform 0.2s ease;
}

.logo:hover {
  transform: scale(1.05);
}

.logo-text {
  color: #f3f4f6;
  font-size: 1.5rem;
  font-weight: bold;
  margin-left: 10px;
}

/* Menú de navegación */
.nav-menu {
  display: flex;
  list-style: none;
  margin: 0;
  transition: all 0.3s ease;
}

.nav-item {
  margin-left: 1.5rem;
  position: relative;
}

.nav-link {
  color: #f3f4f6;
  text-decoration: none;
  display: flex;
  align-items: center;
  padding: 0.5rem;
  transition: all 0.3s ease;
  border-bottom: 3px solid transparent;
}

.nav-link:hover {
  color: #dbeafe;
  border-bottom: 3px solid rgba(219, 234, 254, 0.5);
}

.nav-link.active {
  color: white;
  border-bottom: 3px solid #dbeafe;
  font-weight: 600;
}

.nav-link svg {
  margin-right: 0.5rem;
  width: 1.2rem;
  height: 1.2rem;
}

/* Hamburger menu */
.hamburger {
  display: none;
  cursor: pointer;
  background: transparent;
  border: none;
  padding: 8px;
  border-radius: 4px;
  transition: background-color 0.3s;
}

.hamburger:hover {
  background-color: rgba(255, 255, 255, 0.1);
}

.hamburger svg {
  width: 1.75rem;
  height: 1.75rem;
  fill: #f3f4f6;
}

/* User dropdown */
.user-dropdown {
  position: relative;
  margin-left: 1.5rem;
}

.user-button {
  display: flex;
  align-items: center;
  color: #f3f4f6;
  background: none;
  border: none;
  padding: 0.5rem;
  cursor: pointer;
  transition: all 0.3s ease;
}

.user-button:hover {
  color: #dbeafe;
}

.user-avatar {
  width: 2rem;
  height: 2rem;
  border-radius: 50%;
  background-color: rgba(255, 255, 255, 0.2);
  display: flex;
  align-items: center;
  justify-content: center;
  margin-right: 0.5rem;
  font-weight: 600;
  aspect-ratio: 1 / 1;
}

.user-name {
  margin-right: 0.5rem;
}

.user-menu {
  position: absolute;
  top: 100%;
  right: 0;
  background-color: white;
  border-radius: 0.5rem;
  box-shadow: 0 10px 15px rgba(0, 0, 0, 0.1);
  width: 200px;
  padding: 0.5rem 0;
  display: none;
  z-index: 1000;
}

.user-menu.active {
  display: block;
  animation: fadeIn 0.2s ease-in-out;
}

.user-menu-item {
  display: flex;
  align-items: center;
  padding: 0.75rem 1rem;
  color: #1e293b;
  text-decoration: none;
  transition: background-color 0.2s;
}

.user-menu-item:hover {
  background-color: #f1f5f9;
}

.user-menu-item svg {
  width: 1.25rem;
  height: 1.25rem;
  margin-right: 0.75rem;
}

.user-role {
  padding: 0.75rem 1rem;
  color: #64748b;
  font-size: 0.875rem;
  border-bottom: 1px solid #e2e8f0;
  margin-bottom: 0.5rem;
}

.logout-button {
  color: #ef4444;
}

/* Responsive design */
@media screen and (max-width: 768px) {
  body {
    padding-top: 60px;
  }
  
  .hamburger {
    display: block;
  }

  .container-header {
    padding: 0.75rem 1rem;
  }

  .nav-menu {
    position: fixed;
    left: -100%;
    top: 60px;
    flex-direction: column;
    background-color: #1d4ed8;
    width: 100%;
    text-align: center;
    transition: 0.3s;
    box-shadow: 0 10px 15px rgba(0, 0, 0, 0.1), 0 4px 6px rgba(0, 0, 0, 0.05);
    padding: 1rem 0;
    height: calc(100vh - 60px);
    overflow-y: auto;
    z-index: 999;
  }

  .nav-menu.active {
    left: 0;
  }

  .nav-item {
    margin: 0.75rem 0;
  }

  .nav-link {
    justify-content: center;
    padding: 0.75rem;
    width: 100%;
    border-bottom: none;
  }
  
  .nav-link:hover {
    background-color: rgba(255, 255, 255, 0.1);
    border-bottom: none;
  }
  
  .logo-text {
    font-size: 1.25rem;
  }
  
  .nav-link.active {
    background-color: rgba(255, 255, 255, 0.15);
    border-bottom: none;
    border-left: 3px solid #dbeafe;
  }
  
  .user-dropdown {
    margin-left: 0;
    margin-top: 1rem;
    width: 100%;
  }
  
  .user-button {
    width: 100%;
    justify-content: center;
  }
  
  .user-menu {
    position: static;
    width: 100%;
    box-shadow: none;
    margin-top: 0.5rem;
  }
}

@media screen and (max-width: 480px) {
  body {
    padding-top: 55px;
  }
  
  .container-header {
    padding: 0.75rem 0.5rem;
  }
  
  .logo-text {
    font-size: 1.15rem;
  }
  
  .nav-menu {
    top: 55px;
    height: calc(100vh - 55px);
  }
}

@keyframes fadeIn {
  from { opacity: 0; transform: translateY(10px); }
  to { opacity: 1; transform: translateY(0); }
}
</style>

<header class="header">
    <div class="container-header">
        <a href="/" class="nav-logo">
            <div class="logo">
                <svg width="40" height="40" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path d="M12 2L2 7L12 12L22 7L12 2Z" fill="#f3f4f6"></path>
                    <path d="M2 17L12 22L22 17" stroke="#f3f4f6" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"></path>
                    <path d="M2 12L12 17L22 12" stroke="#f3f4f6" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"></path>
                </svg>
                <span class="logo-text">Sistema Gestión</span>
            </div>
        </a>

        <div class="hamburger" id="hamburger" aria-label="Menú de navegación">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
                <path d="M3 18h18v-2H3v2zm0-5h18v-2H3v2zm0-7v2h18V6H3z"></path>
            </svg>
        </div>

        <nav>
            <ul class="nav-menu" id="nav-menu">
                <li class="nav-item">
                    <a href="/" class="nav-link">
                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-house-fill" viewBox="0 0 16 16">
                            <path d="M8.707 1.5a1 1 0 0 0-1.414 0L.646 8.146a.5.5 0 0 0 .708.708L8 2.207l6.646 6.647a.5.5 0 0 0 .708-.708L13 5.793V2.5a.5.5 0 0 0-.5-.5h-1a.5.5 0 0 0-.5.5v1.293z"/>
                            <path d="m8 3.293 6 6V13.5a1.5 1.5 0 0 1-1.5 1.5h-9A1.5 1.5 0 0 1 2 13.5V9.293z"/>
                        </svg>
                        Inicio
                    </a>
                </li>
                
                <% if (usuario) { %>
                    <% if (usuario.rol === 'admin') { %>
                        <li class="nav-item">
                            <a href="/usuarios" class="nav-link">
                                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-people-fill" viewBox="0 0 16 16">
                                    <path d="M7 14s-1 0-1-1 1-4 5-4 5 3 5 4-1 1-1 1zm4-6a3 3 0 1 0 0-6 3 3 0 0 0 0 6m-5.784 6A2.24 2.24 0 0 1 5 13c0-1.355.68-2.75 1.936-3.72A6.3 6.3 0 0 0 5 9c-4 0-5 3-5 4s1 1 1 1zM4.5 8a2.5 2.5 0 1 0 0-5 2.5 2.5 0 0 0 0 5"/>
                                </svg>
                                Usuarios
                            </a>
                        </li>
                    <% } %>
                    
                    <% if (usuario.rol === 'admin' || usuario.rol === 'tecnico') { %>
                        <li class="nav-item"> 
                            <a href="/equipos" class="nav-link">
                                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-box-fill" viewBox="0 0 16 16">
                                    <path fill-rule="evenodd" d="M15.528 2.973a.75.75 0 0 1 .472.696v8.662a.75.75 0 0 1-.472.696l-7.25 2.9a.75.75 0 0 1-.557 0l-7.25-2.9A.75.75 0 0 1 0 12.331V3.669a.75.75 0 0 1 .471-.696L7.443.184l.004-.001.274-.11a.75.75 0 0 1 .558 0l.274.11.004.001zm-1.374.527L8 5.962 1.846 3.5 1 3.839v.4l6.5 2.6v7.922l.5.2.5-.2V6.84l6.5-2.6v-.4l-.846-.339Z"/>
                                </svg>
                                Inventario
                            </a>
                        </li>
                        
                        <li class="nav-item">
                            <a href="/reparaciones" class="nav-link">
                                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-tools" viewBox="0 0 16 16">
                                    <path d="M1 0 0 1l2.2 3.081a1 1 0 0 0 .815.419h.07a1 1 0 0 1 .708.293l2.675 2.675-2.617 2.654A3.003 3.003 0 0 0 0 13a3 3 0 1 0 5.878-.851l2.654-2.617.968.968-.305.914a1 1 0 0 0 .242 1.023l3.27 3.27a.997.997 0 0 0 1.414 0l1.586-1.586a.997.997 0 0 0 0-1.414l-3.27-3.27a1 1 0 0 0-1.023-.242L10.5 9.5l-.96-.96 2.68-2.643A3.005 3.005 0 0 0 16 3q0-.405-.102-.777l-2.14 2.141L12 4l-.364-1.757L13.777.102a3 3 0 0 0-3.675 3.68L7.462 6.46 4.793 3.793a1 1 0 0 1-.293-.707v-.071a1 1 0 0 0-.419-.814zm9.646 10.646a.5.5 0 0 1 .708 0l2.914 2.915a.5.5 0 0 1-.707.707l-2.915-2.914a.5.5 0 0 1 0-.708M3 11l.471.242.529.026.287.445.445.287.026.529L5 13l-.242.471-.026.529-.445.287-.287.445-.529.026z"/>
                                </svg>
                                Reparaciones
                            </a>
                        </li>
                        
                        <li class="nav-item">
                            <a href="/asignaciones" class="nav-link">
                                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-people-fill" viewBox="0 0 16 16">
                                    <path d="M7 14s-1 0-1-1 1-4 5-4 5 3 5 4-1 1-1 1zm4-6a3 3 0 1 0 0-6 3 3 0 0 0 0 6m-5.784 6A2.24 2.24 0 0 1 5 13c0-1.355.68-2.75 1.936-3.72A6.3 6.3 0 0 0 5 9c-4 0-5 3-5 4s1 1 1 1zM4.5 8a2.5 2.5 0 1 0 0-5 2.5 2.5 0 0 0 0 5"/>
                                </svg>
                                Asignaciones
                            </a>
                        </li>
                        
                        <% if (usuario.rol === 'admin') { %>
                        <li class="nav-item">
                            <a href="/bitacoras" class="nav-link">
                                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-clipboard2-check-fill" viewBox="0 0 16 16">
                                    <path d="M10 .5a.5.5 0 0 0-.5-.5h-3a.5.5 0 0 0-.5.5.5.5 0 0 1-.5.5.5.5 0 0 0-.5.5V2a.5.5 0 0 0 .5.5h5A.5.5 0 0 0 11 2v-.5a.5.5 0 0 0-.5-.5.5.5 0 0 1-.5-.5"/>
                                    <path d="M4.085 1H3.5A1.5 1.5 0 0 0 2 2.5v12A1.5 1.5 0 0 0 3.5 16h9a1.5 1.5 0 0 0 1.5-1.5v-12A1.5 1.5 0 0 0 12.5 1h-.585q.084.236.085.5V2a1.5 1.5 0 0 1-1.5 1.5h-5A1.5 1.5 0 0 1 4 2v-.5q.001-.264.085-.5z"/>
                                    <path d="M10.854 7.854a.5.5 0 0 0-.708-.708L7.5 9.793 6.354 8.646a.5.5 0 1 0-.708.708l1.5 1.5a.5.5 0 0 0 .708 0l3-3z"/>
                                </svg>
                                Bitácoras
                            </a>
                        </li>
                        <% } %>
                    <% } %>
                    
                    <% if (usuario.rol === 'admin') { %>
                        <li class="nav-item">
                            <a href="/reportes" class="nav-link">
                                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-bar-chart-line-fill" viewBox="0 0 16 16">
                                    <path d="M11 2a1 1 0 0 1 1-1h2a1 1 0 0 1 1 1v12h.5a.5.5 0 0 1 0 1H.5a.5.5 0 0 1 0-1H1v-3a1 1 0 0 1 1-1h2a1 1 0 0 1 1 1v3h1V7a1 1 0 0 1 1-1h2a1 1 0 0 1 1 1v7h1z"/>
                                </svg>
                                Reportes
                            </a>
                        </li>
                    <% } %>
                    
                    <% if (usuario.rol === 'usuario_final') { %>
                        <li class="nav-item">
                            <a href="/mi-equipo" class="nav-link">
                                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-laptop" viewBox="0 0 16 16">
                                    <path d="M13.5 3a.5.5 0 0 1 .5.5V11H2V3.5a.5.5 0 0 1 .5-.5zm-11-1A1.5 1.5 0 0 0 1 3.5V12h14V3.5A1.5 1.5 0 0 0 13.5 2zM0 12.5h16a1.5 1.5 0 0 1-1.5 1.5h-13A1.5 1.5 0 0 1 0 12.5"/>
                                </svg>
                                Mis Equipos
                            </a>
                        </li>
                    <% } %>
                <% } %>
            </ul>
        </nav>
        
        <% if (usuario) { %>
            <div class="user-dropdown" id="userDropdown">
                <button class="user-button" id="userButton">
                    <div class="user-avatar"><%= usuario.nombre.charAt(0).toUpperCase() %></div>
                    <span class="user-name d-none d-md-block"><%= usuario.nombre %></span>
                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-chevron-down" viewBox="0 0 16 16">
                        <path fill-rule="evenodd" d="M1.646 4.646a.5.5 0 0 1 .708 0L8 10.293l5.646-5.647a.5.5 0 0 1 .708.708l-6 6a.5.5 0 0 1-.708 0l-6-6a.5.5 0 0 1 0-.708z"/>
                    </svg>
                </button>
                
                <div class="user-menu" id="userMenu">
                    <div class="user-role">
                        <% if (usuario.rol === 'admin') { %>
                            Administrador
                        <% } else if (usuario.rol === 'tecnico') { %>
                            Técnico
                        <% } else { %>
                            Usuario
                        <% } %>
                    </div>
                    
                    <a href="/auth/logout" class="user-menu-item logout-button">
                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-box-arrow-right" viewBox="0 0 16 16">
                            <path fill-rule="evenodd" d="M10 12.5a.5.5 0 0 1-.5.5h-8a.5.5 0 0 1-.5-.5v-9a.5.5 0 0 1 .5-.5h8a.5.5 0 0 1 .5.5v2a.5.5 0 0 0 1 0v-2A1.5 1.5 0 0 0 9.5 2h-8A1.5 1.5 0 0 0 0 3.5v9A1.5 1.5 0 0 0 1.5 14h8a1.5 1.5 0 0 0 1.5-1.5v-2a.5.5 0 0 0-1 0z"/>
                            <path fill-rule="evenodd" d="M15.854 8.354a.5.5 0 0 0 0-.708l-3-3a.5.5 0 0 0-.708.708L14.293 7.5H5.5a.5.5 0 0 0 0 1h8.793l-2.147 2.146a.5.5 0 0 0 .708.708l3-3z"/>
                        </svg>
                        Cerrar Sesión
                    </a>
                </div>
            </div>
        <% } else { %>
            <a href="/auth/login" class="btn btn-light btn-sm">Iniciar Sesión</a>
        <% } %>
    </div>
</header>

<script>
// menu hamburguesa
document.addEventListener('DOMContentLoaded', function() {
    const hamburger = document.getElementById('hamburger');
    const navMenu = document.getElementById('nav-menu');
    
    // alternar el menu
    function toggleMenu() {
        navMenu.classList.toggle('active');
        // indicar si el menú esta expandido
        const isExpanded = navMenu.classList.contains('active');
        hamburger.setAttribute('aria-expanded', isExpanded);
    }
    
    // Evento para el boton hamburguesa
    if (hamburger) {
        hamburger.addEventListener('click', toggleMenu);
    }
    
    // Cerrar el menú al hacer clic en un enlace
    document.querySelectorAll('.nav-link').forEach(link => {
        link.addEventListener('click', () => {
            navMenu.classList.remove('active');
            if (hamburger) {
                hamburger.setAttribute('aria-expanded', false);
            }
        });
    });
    
    // Cerrar el menu
    document.addEventListener('click', function(event) {
        if (!navMenu) return;
        
        const isClickInsideMenu = navMenu.contains(event.target);
        const isClickOnHamburger = hamburger && hamburger.contains(event.target);
        
        if (!isClickInsideMenu && !isClickOnHamburger && navMenu.classList.contains('active')) {
            toggleMenu();
        }
    });
    
    // Marcar el enlace activo segun la ruta actual
    const currentPath = window.location.pathname;
    const links = document.querySelectorAll('.nav-link');
    
    links.forEach(link => {
        const href = link.getAttribute('href');
        // Si el href del enlace coincide con la ruta actual o es la pagina inicial
        if (href === currentPath || (currentPath === '/' && href === '/')) {
            link.classList.add('active');
        } else if (currentPath.startsWith(href) && href !== '/') {
            // Para secciones como /equipos/crear que deben mantener activo el menú de equipos
            link.classList.add('active');
        }
    });
    
    // User dropdown
    const userButton = document.getElementById('userButton');
    const userMenu = document.getElementById('userMenu');
    
    if (userButton && userMenu) {
        userButton.addEventListener('click', function(e) {
            e.stopPropagation();
            userMenu.classList.toggle('active');
        });
        
        document.addEventListener('click', function(e) {
            if (!userButton.contains(e.target) && !userMenu.contains(e.target)) {
                userMenu.classList.remove('active');
            }
        });
    }
    
    //detectar tecla enter o espacio para abrir el menu
    if (hamburger) {
        hamburger.addEventListener('keydown', function(e) {
            if (e.key === 'Enter' || e.key === ' ') {
                e.preventDefault();
                toggleMenu();
            }
        });
    }
});
</script>

